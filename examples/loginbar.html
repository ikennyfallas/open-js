<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
		<title>登录与登出信息条</title>
		<style>
            body{font-size:12px;font-family:consolas,"Microsoft YaHei";padding:0;margin:0;}
			ul,ol,li,label,textarea{display:block;padding:0;margin:0;}
			input,textarea{font-family:menlo,monaco,consolas,"Microsoft YaHei"}
			input{font-size:14px;outline:none;}
			ul{list-style-type:none;}
			a{text-decoration:none;}

			.main{width:95%;margin:0 auto;}

			.caption{font-size:18px;}
			.section{padding:15px;margin:15px;background:whiteSmoke;border:1px solid #e5e5e5;border-radius:15px;}

			.bold{font-weight:bold;}
			.no-border{border:none;}

			#appkey{width:340px;padding:0px 5px;}
			.appkeylabel{height:20px;overflow:hidden;}
			.appkeylabel div{float:left;}
			.appkey-valid{color:green;background:whiteSmoke;}
			.appkey-nokey{font-weight:normal;color:#ccc;background:white;}
			.appkey-invalid{color:red;}


        </style>
        <script src="../build/all.js"></script>
        <script type="text/javascript">
            <!--
            //
            // patch of innerText for firefox
            //
            (function (bool) {
                function setInnerText(o, s) {
                    while (o.childNodes.length != 0) {
                        o.removeChild(o.childNodes[0]);
                    }
            
                    o.appendChild(document.createTextNode(s));
                }
            
                function getInnerText(o) {
                    var sRet = "";
            
                    for (var i = 0; i < o.childNodes.length; i ++) {
                        if (o.childNodes[i].childNodes.length != 0) {
                            sRet += getInnerText(o.childNodes[i]);
                        }
            
                        if (o.childNodes[i].nodeValue) {
                            if (o.currentStyle.display == "block") {
                                sRet += o.childNodes[i].nodeValue + "\n";
                            } else {
                                sRet += o.childNodes[i].nodeValue;
                            }
                        }
                    }
            
                    return sRet.replace(/\s/,'');
                }
            
                if (bool) {
                    HTMLElement.prototype.__defineGetter__("currentStyle", function () {
                        return this.ownerDocument.defaultView.getComputedStyle(this, null);
                    });
            
                    HTMLElement.prototype.__defineGetter__("innerText", function () {
                        return getInnerText(this);
                    })
            
                    HTMLElement.prototype.__defineSetter__("innerText", function(s) {
                        setInnerText(this, s);
                    })
                }
            })(/Firefox/.test(window.navigator.userAgent));
            //-->
        </script>
		
		<script>

		// appkey配置
    	(function () { 
            var
         		    appkey = T.cookie.get("appkey"),
					oauthkey = /^[a-z\d][a-z\d]{30}[a-z\d]$/i,
					oauth2key = /^[1-9][0-9]{7}[0-9]$/,
         	        placeholder = "请输入appkey";
    
			appkey = (oauthkey.test(appkey) || oauth2key.test(appkey)) ? appkey : "";  

         	appkey &&
    	    	T.init({
    				"appkey": appkey
    	    	});
    

        	T.documentReady(function () {
    	    	var appkeyholder = document.getElementById("appkey");			
        		appkeyholder.onfocus = function () {
        			if (this.innerText == placeholder) {
        				this.innerHTML = '';
        			}
    			    T.dom.removeClass(appkeyholder,"appkey-valid")
    			         .removeClass(appkeyholder,"appkey-invalid")
                         .addClass(appkeyholder,"appkey-nokey")
        		};
        		appkeyholder.onblur = function () {
					var appkey = T.String.trim(this.innerText);
        			if (appkey.length <= 0) {
        		        this.innerText = placeholder;
        				T.cookie.del("appkey");
						T.dom.removeClass(appkeyholder,"appkey-valid")
						     .addClass(appkeyholder,"appkey-nokey");
    				} else {
						T.dom.removeClass(appkeyholder,"appkey-nokey")
				    	// 检查APPKEY是否有效
				    	if (oauthkey.test(appkey) || oauth2key.test(appkey)) {
    				    	T._inited ? (T._appkey = this.innerText) :
                                        T.init({"appkey": this.innerText});
        			        T.cookie.set("appkey",this.innerText, 3600 * 24 * 365);
							T.dom.removeClass(appkeyholder,"appkey-invalid")
						         .addClass(appkeyholder,"appkey-valid");
			        	} else {
							T.dom.removeClass(appkeyholder,"appkey-valid")
							T.dom.addClass(appkeyholder,"appkey-invalid");
			        	}
    				}
        		};
        	});
    
        	(appkey ? function () {
                	T.documentReady(function () {
    					var appkeyholder = document.getElementById("appkey");
    					appkeyholder.innerText = appkey;
    					T.dom.addClass(appkeyholder,"appkey-valid");
                	});
        	    } :
                function () {
                    T.documentReady(function () {
    					var appkeyholder = document.getElementById("appkey");
    					appkeyholder.innerText = placeholder;
    					T.dom.addClass(appkeyholder,"appkey-nokey");
                        appkeyholder.focus();
                    });
                })();
    
    	}());

		//登录登出
    	T.everythingReady(function () {
			var 
			       loginbar = document.getElementById("loginbar"),
				   loginStatus = T.loginStatus();

			var
		      	messages = {
					hasLoggedIn: '欢迎,%s,<a id="logout" href="javascript:void(0);">登出</a>'
				   ,notLoggedIn: '<a id="login" href="javascript:void(0);">登录</a>'
				   ,loginSuccess: '您已登录,%s,<a id="logout" href="javascript:void(0);">登出</a>'
				   ,loginFail: '登录失败,%s,请重新<a id="login" href="javascript:void(0);">登录</a>'
		       	};

			var loginSuccessHandler = function (loginstatus) {
				    loginbar.innerHTML = T.format.sprintf(messages.loginSuccess, loginstatus.nick);
			    },
		    	loginFailHandler = function (message) {
				    loginbar.innerHTML = T.format.sprintf(messages.loginFail, message.error);
		    	};

	    	if (loginStatus) {
				loginbar.innerHTML = T.format.sprintf(messages.hasLoggedIn, loginStatus.nick); 
			} else {
				loginbar.innerHTML = messages.notLoggedIn;
			}

	    	document.body.onclick = function (e) {
				e = e || window.event;
				var el = e.srcElement || e.originalTarget;
				if (el) {
		        	switch (el.id) {
			    		case "logout":
			    			T.logout();
			    			loginbar.innerHTML = "您已登出," + '<a id="login" href="javascript:void(0);">登录</a>';
			    			break;
			    		case "login":
			    			T.login(loginSuccessHandler,loginFailHandler);
			    			break;
		        	}
			    }
	    	};
    	});
		</script>
	</head>
    <!--[if lt IE 7 ]><body class="ie_6"><![endif]-->
    <!--[if IE 7 ]><body class="ie_7"><![endif]-->
    <!--[if IE 8 ]><body class="ie_8"><![endif]-->
    <!--[if IE 9 ]><body class="ie_9"><![endif]-->
    <!--[if (gt IE 9)|!(IE)]><!-->
    <body>
    <!--<![endif]-->
    
	<div class="main">
	    <!-- Appkey配置 -->
    	<div class="caption section appkeylabel">
			<div>AppKey:</div><div class="caption" id="appkey" contenteditable="true"></div>
    	</div>
    
    	<!-- 登录与登出 -->
    	<div class="caption section" id="loginbar">登录中,请稍候...</div>
    </div>
	</body>
</html>
